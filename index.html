<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laporan Index Shift (Index terakhir CO)</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    body { background:#f6f7fb; padding:20px; font-family:"Segoe UI",Roboto,Arial; }
    .container { max-width:1100px; background:#fff; border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,.1); overflow:hidden; margin:0 auto; }

    .site-top{ background:#1976d2; color:#fff; padding:12px 18px }
    .title{ margin:0; font-size:18px; font-weight:700 }

    .content-area{ padding:20px 25px }
    #judulLaporan{ font-weight:700; font-size:18px; text-align:center }

    #resultTable thead th{
      background:#1976d2!important;color:#fff!important;text-align:center;
      font-weight:700;border-color:#1565c0!important;cursor:pointer;
    }

    .table-danger td{ background:#ffeaea!important }
    .table-index-warning td{ background:#ffcc80!important }

    #copyright{ text-align:center;font-size:13px;color:#666;margin:18px 0 }
  </style>
</head>

<body>
<div class="container">

  <div class="site-top">
    <h1 class="title">Laporan Index Shift</h1>
  </div>

  <div class="content-area">

    <div class="d-flex justify-content-between align-items-center mb-2">
      <button id="generateBtn" class="btn btn-success" disabled>Hitung Index</button>
      <button id="shareBtn" class="btn btn-success">ðŸ“¤ Share ke WhatsApp</button>
    </div>

    <div id="judulLaporan" class="mt-2"></div>

    <div id="resultArea" class="mt-2">
      <table id="resultTable" class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Shift</th>
            <th>LastCO</th>
            <th>IndexCO</th>
            <th>TotalCO</th>
            <th>SLA</th>
            <th>DurasiSLA</th>
            <th>InProgress</th>
            <th>Relasi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

  <div id="copyright">Â© 2025 EDP Fai</div>
</div>

<script>
/* ===== SHARE KE WHATSAPP ===== */
document.getElementById("shareBtn").addEventListener("click", async () => {
  const area = document.querySelector("#resultArea");
  if (!area || !area.innerText.trim()) {
    alert("Belum ada data untuk dibagikan.");
    return;
  }

  const judul =
    document.getElementById("judulLaporan")?.innerText ||
    "Laporan Index CO";

  const canvas = await html2canvas(area, {
    scale: 2,
    backgroundColor: "#ffffff"
  });

  canvas.toBlob(blob => {
    const file = new File([blob], "Laporan_Index_CO.jpg", {
      type: "image/jpeg"
    });

    // Jika support Web Share API (Android Chrome)
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      navigator.share({
        title: judul,
        text: `${judul}`,
        files: [file]
      }).catch(()=>{});
    } else {
      // Fallback desktop / iOS
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "Laporan_Index_CO.jpg";
      a.click();

      const text = encodeURIComponent(
        `${judul}\n\n(Lampiran laporan terdownload)`
      );
      window.open(`https://wa.me/?text=${text}`, "_blank");
    }
  }, "image/jpeg", 0.95);
});
</script>

</body>
</html>
