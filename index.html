<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laporan Index Shift (Index Terakhir CO)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; padding: 20px; }
    h3 { margin-bottom: 20px; }
    table th {
      cursor: pointer;
      user-select: none;
      background-color: #0d6efd;
      color: white;
      text-align: center;
      vertical-align: middle;
    }
    table th.no-sort { cursor: default; background-color: #6c757d; }
    table td { vertical-align: middle; }
    .upload-btn {
      background-color: #198754;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .upload-btn:hover {
      background-color: #157347;
    }
  </style>
</head>

<body>
  <div class="container">
    <h3 class="text-center mb-4">üìä Laporan Index Shift (Index Terakhir CO)</h3>

    <div class="mb-3 text-center">
      <label for="fileInput" class="upload-btn">üì§ Upload File</label>
      <input type="file" id="fileInput" accept=".csv" hidden>
    </div>

    <table class="table table-bordered table-striped table-hover text-center align-middle">
      <thead>
        <tr>
          <th class="no-sort">Nomor</th>
          <th onclick="sortTable(1)">Nama Karyawan ‚¨ç</th>
          <th onclick="sortTable(2)">Shift ‚¨ç</th>
          <th onclick="sortTable(3)">IndexCO ‚¨ç</th>
          <th onclick="sortTable(4)">TotalCO ‚¨ç</th>
          <th onclick="sortTable(5)">SLA ‚¨ç</th>
          <th onclick="sortTable(6)">LastCO ‚¨ç</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const tableBody = document.getElementById("tableBody");

    // --- BACA FILE CSV ---
    fileInput.addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const rows = text.trim().split("\n").map(r => r.split(","));
        renderTable(rows);
      };
      reader.readAsText(file);
    });

    // --- RENDER DATA ---
    function renderTable(data) {
      tableBody.innerHTML = "";
      data.forEach((row, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${row[0]}</td>
          <td>${row[1]}</td>
          <td>${parseFloat(row[2]).toFixed(2)}</td>
          <td>${row[3]}</td>
          <td>${row[4]}</td>
          <td>${row[5]}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // --- SORT UNIVERSAL ---
    function sortTable(index) {
      const table = document.querySelector("table tbody");
      const rows = Array.from(table.querySelectorAll("tr"));
      const prevIndex = table.getAttribute("data-sort-index");
      const prevOrder = table.getAttribute("data-sort-order");
      const isAsc = prevIndex == index && prevOrder == "asc";
      const order = isAsc ? "desc" : "asc";

      table.setAttribute("data-sort-index", index);
      table.setAttribute("data-sort-order", order);

      rows.sort((a, b) => {
        let A = a.children[index].innerText.trim();
        let B = b.children[index].innerText.trim();

        const numA = parseFloat(A.replace(",", "."));
        const numB = parseFloat(B.replace(",", "."));
        const isNumeric = !isNaN(numA) && !isNaN(numB);

        const timeRegex = /^([01]\d|2[0-3]):([0-5]\d)(:[0-5]\d)?$/;
        const isTime = timeRegex.test(A) && timeRegex.test(B);

        let result = 0;
        if (isNumeric) {
          result = numA - numB;
        } else if (isTime) {
          const [hA, mA] = A.split(":").map(Number);
          const [hB, mB] = B.split(":").map(Number);
          result = (hA * 60 + mA) - (hB * 60 + mB);
        } else {
          result = A.localeCompare(B, "id", { numeric: true, sensitivity: "base" });
        }

        return order === "asc" ? result : -result;
      });

      table.innerHTML = "";
      rows.forEach(r => table.appendChild(r));
    }
  </script>
</body>
</html>
